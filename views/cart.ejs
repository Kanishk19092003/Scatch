<%- include('./partials/header') %>
    <%
    let totalMRP = 0;
    let totalDiscount = 0;
    if (user && user.cart) {
        user.cart.forEach(function(product){
            totalMRP += product.price;
            totalDiscount += (product.price * product.discount / 100);
        });
    }
    const platformFee = 20;
    const finalAmount = totalMRP - totalDiscount + platformFee;
    %>
    <div class="w-full min-h-screen bg-white text-zinc-900 px-4 sm:px-10 md:px-20 py-10">
        <div class="container mx-auto">
            <h1 class="text-3xl font-bold mb-8">Your Shopping Cart</h1>
            <% if (!user || user.cart.length === 0) { %>
                <div class="text-center py-20">
                    <h2 class="text-2xl font-semibold">Your cart is empty.</h2>
                    <a href="/shop" class="mt-4 inline-block px-6 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors">Continue Shopping</a>
                </div>
            <% } else { %>
                <div class="flex flex-col lg:flex-row gap-10">
                    <!-- Cart Items -->
                    <div class="w-full lg:w-2/3 flex flex-col gap-5">
                        <% user.cart.forEach(function(product){ %>
                            <div class="flex gap-5 border-b border-zinc-200 pb-5">
                                <!-- Image on Left -->
                                <div class="w-32 h-32 flex-shrink-0 rounded-md overflow-hidden bg-zinc-100 flex items-center justify-center" style="background-color: <%= product.bgcolor || '#e0e0e0' %>;">
                                    <% if (product.image && product.image.length > 32) { %>
                                        <img class="h-full w-full object-contain" src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" alt="<%= product.name %>">
                                    <% } else { %>
                                        <span class="text-xs">No Img</span>
                                    <% } %>
                                </div>
                                <!-- Details on Right -->
                                <div class="flex-grow flex flex-col justify-between">
                                    <div>
                                        <h3 class="text-xl font-semibold"><%= product.name %></h3>
                                        <div class="flex items-baseline gap-3 mt-2">
                                            <h4 class="text-lg font-bold">$<%= (product.price * (1 - product.discount / 100)).toFixed(2) %></h4>
                                            <% if(product.discount > 0){ %>
                                                <h4 class="text-sm text-gray-500 line-through">$<%= product.price %></h4>
                                                <span class="text-sm font-semibold text-green-600"><%= product.discount %>% OFF</span>
                                            <% } %>
                                        </div>
                                    </div>
                                    <a href="/cart/remove/<%= product._id %>" class="text-red-500 hover:underline self-start">Remove</a>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                    <!-- Bill Section -->
                    <div class="w-full lg:w-1/3 bg-zinc-100 p-6 rounded-lg h-fit">
                        <h3 class="text-xl font-semibold border-b border-zinc-300 pb-3">Price Breakdown</h3>
                        <div class="mt-5 space-y-3 text-sm">
                            <div class="flex justify-between"><span>Total MRP</span> <span>$<%= totalMRP.toFixed(2) %></span></div>
                            <div class="flex justify-between text-green-600"><span>Discount on MRP</span> <span>-$<%= totalDiscount.toFixed(2) %></span></div>
                            <div class="flex justify-between"><span>Platform Fee</span> <span>$<%= platformFee.toFixed(2) %></span></div>
                            <div class="flex justify-between"><span>Shipping Fee</span> <span class="text-green-600">FREE</span></div>
                        </div>
                        <div class="w-full h-[1px] bg-zinc-300 my-5"></div>
                        <div class="flex justify-between mt-5">
                            <h3 class="text-lg font-bold">Total Amount</h3>
                            <h3 class="font-bold text-lg text-green-600">$<%= finalAmount.toFixed(2) %></h3>
                        </div>
                        <button class="w-full mt-6 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded-md transition-colors">Place Order</button>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
    <%- include('./partials/footer') %>